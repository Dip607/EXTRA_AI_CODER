<!-- templates/forum/base.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Code Doubt Forum</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-left: 3px solid #6c757d;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
    <a class="navbar-brand" href="{% url 'home' %}">CodeForum</a>

    <div class="ms-auto d-flex align-items-center gap-2">
        {% if user.is_authenticated %}
            {% if user.role == "student" %}
                <a href="{% url 'student_dashboard' %}" class="btn btn-outline-light">Dashboard</a>
                <a href="{% url 'ask_doubt' %}" class="btn btn-outline-info">Ask Doubt</a>
                <a href="{% url 'notifications' %}" class="btn btn-outline-warning position-relative">
                    ðŸ”” Notifications
                    <span id="notif-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                        0
                    </span>
                </a>
            {% elif user.role == "faculty" %}
                <a href="{% url 'faculty_dashboard' %}" class="btn btn-outline-light">Dashboard</a>
            {% endif %}
            <a href="{% url 'leaderboard' %}" class="btn btn-outline-warning">Leaderboard</a>

            <form method="POST" action="{% url 'logout' %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-danger">Logout</button>
            </form>
        {% else %}
            <a href="{% url 'login' %}" class="btn btn-outline-light me-2">Login</a>
            <a href="{% url 'signup' %}" class="btn btn-outline-success">Signup</a>
        {% endif %}
    </div>
</nav>

<div class="container mt-4">
    {% block content %}{% endblock %}
</div>

<!-- ðŸ”„ Real-time Notification Polling Script -->
{% if user.is_authenticated and user.role == "student" %}
<script>
    function fetchNotifCount() {
        fetch("{% url 'unread_notification_count' %}")
            .then(response => response.json())
            .then(data => {
                const count = data.count;
                const badge = document.getElementById("notif-count");
                if (count > 0) {
                    badge.textContent = count;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            })
            .catch(error => console.error("Notification fetch error:", error));
    }

    // Initial fetch and polling every 10s
    document.addEventListener("DOMContentLoaded", () => {
        fetchNotifCount();
        setInterval(fetchNotifCount, 10000);
    });
</script>
{% endif %}
</body>
</html>
